version: '3'


vars:
  R_HIGHS_LIB_DIR: "/home/f/lib/highslib"


tasks:
  compile_attributes:
    cmds:
      - R -e 'Rcpp::compileAttributes(".")'

  docs:
    cmds:
      - R -e 'library("roxygen2"); roxygenize(".", c("rd", "namespace"), load_source)'

  build:
    cmds:
      - task compile_attributes
      - task docs
      - R CMD build .

  inst:
    cmds:
      - task build
      - R CMD INSTALL highs_*.tar.gz

  check:
    cmds:
      - task build
      - R CMD check highs_*.tar.gz

  check_as_cran:
    cmds:
      - task build
      - R CMD check --as-cran highs_*.tar.gz

  readme:
    cmds:
      - R -e 'rmarkdown::render("README.Rmd", clean = FALSE)'
      - pandoc README.md -s --highlight-style=pygments -o README.html

  manual:
    cmds:
      - task clean
      - R CMD Rd2pdf --output=Manual.pdf .

  clean:
    cmds:
      - rm -f Manual.pdf README.knit.md README.html
      - rm -rf .Rd2pdf*
      - rm -rf highs.Rcheck

  remove_highslib:
    cmds:
      - rm -rf "{{.R_HIGHS_LIB_DIR}}"

  devcheck_win_devel:
    cmds:
      - task build
      - R -e "devtools::check_win_devel(email = 'FlorianSchwendinger@gmx.at')"
